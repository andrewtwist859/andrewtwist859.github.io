<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Course Search</title>

  <!-- Fonts -->
  <link href="https://use.typekit.net/jou7rrz.css" rel="stylesheet"/>
  <link rel="stylesheet" href="ugheader.css"> 

  <!-- Choices.js -->
  
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    body {
      font-family: "source-sans-pro", sans-serif;
      margin: 2rem;
      background: #f4f4f4;
    }


    .search-input {
      padding: 0.6rem 1rem;
      font-size: 1rem;
      width: 100%;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
    }

    #subjectSelect {
      width: 100%;
    }


    #courseContainer {
  display: block;
  max-width: 1200px;
  margin: 0 auto;
}


    .card {
      background: #fff;
      padding: 1.5rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
      border-top: 6px solid #440099;
      font-family: "source-sans-pro", sans-serif;
    }

    .level {
      color: #440099;
      font-weight: bold;
      font-size: 1rem;
      text-transform: uppercase;
      margin-bottom: 0.3rem;
    }

    .title {
      margin: 0.2rem 0;
      font-size: 1.4rem;
      font-family: "source-serif-pro", serif;
      font-weight: 700;
    }

    .start-date-pill {
      display: inline-block;
      background: #eee;
      color: #444;
      font-size: 0.85rem;
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      margin: 0.5rem 0;
    }

    .description {
      margin: 0.5rem 0 1rem 0;
      color: #333;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .course-list {
      padding-left: 1.2rem;
      margin: 0;
    }

    .course-list li {
      margin-bottom: 0.3rem;
    }

    .course-list a {
      color: #440099;
      text-decoration: none;
    }

    .course-list a:hover {
      text-decoration: underline;
    }

    .filters {
  display: flex;
  flex-wrap: nowrap;
  gap: 1rem;
  max-width: 1200px;
  margin: 0 auto 2rem auto;
  align-items: stretch;
}

.filter-item {
  flex: 1;
  min-width: 0;
}

.search-input,
#subjectSelect {
  box-sizing: border-box;
  font-size: 1rem;
  padding: 0.6rem 1rem;
  width: 100%;
  border: 2px solid #e0e0e0;
  border-radius: 6px;
  background-color: white;
  color: #333;
  appearance: none;
  min-height: 44px;
}

.select-wrapper {
  position: relative;
}

.select-wrapper .custom-arrow {
  position: absolute;
  top: 50%;
  right: 1rem;
  transform: translateY(-50%);
  pointer-events: none;
  width: 1rem;
  height: 1rem;
  display: flex;
  align-items: center;
  justify-content: center;
}

.select-wrapper .custom-arrow svg {
  width: 100%;
  height: 100%;
  fill: #2a2a87;
}

.clear-button {
  padding: 0.6rem 1rem;
  font-size: 1rem;
  background-color: #e0e0e0;
  color: #E7004C;
  cursor: pointer;
  transition: background 0.2s ease;
  height: 44px;
  white-space: nowrap;
  border: none;
}

#paginationControls {
  text-align: center;
  margin-top: 2rem;
}

.page-btn {
  padding: 0.5rem 1rem;
  margin: 0 0.25rem;
  background: white;
  color: #2a2a87;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.2s ease;
  border: none;
}

.page-btn:hover:not(:disabled) {
  background: #2a2a87;
  color: white;
}

.page-btn.current {
  background: #2a2a87;
  color: white;
  cursor: default;
}

h3.courses {
  margin: 0.5rem 0rem;
  font-family: 'source-serif-pro';
  font-weight: 700;
}

.results-count {
  text-align: center;
  margin-top: 0.5rem;
  font-size: 0.95rem;
  color: #333;
}

.dataset-toggle {
  max-width: 1200px;
  margin: 0 auto 2rem auto;
}

.dataset-btn {
  padding: 0.5rem 1rem;
  font-family: 'source-sans-pro';
  font-weight: 700;
  font-size: 1rem;
  margin-right: 0.5rem;
  border-radius: 20px;
  background: #e0e0e0;
  color: #2a2a87;
  cursor: pointer;
  border: 0;
}

.dataset-btn.active {
  background: #2a2a87;
  color: white;
}

h1 {
  font-family: 'source-serif-pro';
  font-weight: 700;
  font-size: 3rem;
  margin-bottom: 0.5rem;
}

.search-wrapper {
  position: relative;
  width: 100%;
}

.clear-search {
  position: absolute;
  right: 0.75rem;
  top: 50%;
  transform: translateY(-50%);
  background: transparent;
  border: none;
  font-size: 1.25rem;
  color: #2a2a87;
  cursor: pointer;
  display: none;
  padding: 0;
  line-height: 1;
}

@media (max-width: 768px) {
  .filters {
    flex-direction: column;
    gap: 1rem;
  }

  .filter-item {
    width: 100%;
  }

  .clear-button {
    width: 100%;
  }
}

.course-group-heading {
  font-family: "source-serif-pro", serif;
  font-weight: 700;
  font-size: 2rem;
  margin: 2.5rem auto 1rem;
  max-width: 1200px;
}

.course-grid {
  display: grid;
  gap: 2rem;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  max-width: 1200px;
  margin: 0 auto 3rem;
}

.card.pgt .level {
  color: #7100ff;
}


  </style>
</head>
<body>
  <div class="course-banner-dark">
    <div class="olp-banner-dark">
      <span class="entry">Our subjects</span>
        <div class="course-container">
        <h1 class="course-dark">Biosciences</h1><span class="award-dark">BA</span></div>
        <span class="school">School of Journalism, Media and Communication</span>
        <p class="summary">Practice journalism for real with your own patch in the city. Each day will present you with a new challenge: you could be on location filming for a breaking TV news story, heading to the courtroom to hunt down details of a criminal prosecution, or interviewing a sports star for an Instagram reel.</p>
        <div class="icon-section">
            <div class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="24" height="24" fill="white">
                    <path d="M173.8 5.5c11-7.3 25.4-7.3 36.4 0L228 17.2c6 3.9 13 5.8 20.1 5.4l21.3-1.3c13.2-.8 25.6 6.4 31.5 18.2l9.6 19.1c3.2 6.4 8.4 11.5 14.7 14.7L344.5 83c11.8 5.9 19 18.3 18.2 31.5l-1.3 21.3c-.4 7.1 1.5 14.2 5.4 20.1l11.8 17.8c7.3 11 7.3 25.4 0 36.4L366.8 228c-3.9 6-5.8 13-5.4 20.1l1.3 21.3c.8 13.2-6.4 25.6-18.2 31.5l-19.1 9.6c-6.4 3.2-11.5 8.4-14.7 14.7L301 344.5c-5.9 11.8-18.3 19-31.5 18.2l-21.3-1.3c-7.1-.4-14.2 1.5-20.1 5.4l-17.8 11.8c-11 7.3-25.4 7.3-36.4 0L156 366.8c-6-3.9-13-5.8-20.1-5.4l-21.3 1.3c-13.2 .8-25.6-6.4-31.5-18.2l-9.6-19.1c-3.2-6.4-8.4-11.5-14.7-14.7L39.5 301c-11.8-5.9-19-18.3-18.2-31.5l1.3-21.3c.4-7.1-1.5-14.2-5.4-20.1L5.5 210.2c-7.3-11-7.3-25.4 0-36.4L17.2 156c3.9-6 5.8-13 5.4-20.1l-1.3-21.3c-.8-13.2 6.4-25.6 18.2-31.5l19.1-9.6C65 70.2 70.2 65 73.4 58.6L83 39.5c5.9-11.8 18.3-19 31.5-18.2l21.3 1.3c7.1 .4 14.2-1.5 20.1-5.4L173.8 5.5zM272 192a80 80 0 1 0 -160 0 80 80 0 1 0 160 0zM1.3 441.8L44.4 339.3c.2 .1 .3 .2 .4 .4l9.6 19.1c11.7 23.2 36 37.3 62 35.8l21.3-1.3c.2 0 .5 0 .7 .2l17.8 11.8c5.1 3.3 10.5 5.9 16.1 7.7l-37.6 89.3c-2.3 5.5-7.4 9.2-13.3 9.7s-11.6-2.2-14.8-7.2L74.4 455.5l-56.1 8.3c-5.7 .8-11.4-1.5-15-6s-4.3-10.7-2.1-16zm248 60.4L211.7 413c5.6-1.8 11-4.3 16.1-7.7l17.8-11.8c.2-.1 .4-.2 .7-.2l21.3 1.3c26 1.5 50.3-12.6 62-35.8l9.6-19.1c.1-.2 .2-.3 .4-.4l43.2 102.5c2.2 5.3 1.4 11.4-2.1 16s-9.3 6.9-15 6l-56.1-8.3-32.2 49.2c-3.2 5-8.9 7.7-14.8 7.2s-11-4.3-13.3-9.7z"/>
                </svg>
                <a href="#">Accredited</a>
            </div>
            <div class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="30" height="24" fill="white"><!--!Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M512 80c0 18-14.3 34.6-38.4 48c-29.1 16.1-72.5 27.5-122.3 30.9c-3.7-1.8-7.4-3.5-11.3-5C300.6 137.4 248.2 128 192 128c-8.3 0-16.4 .2-24.5 .6l-1.1-.6C142.3 114.6 128 98 128 80c0-44.2 86-80 192-80S512 35.8 512 80zM160.7 161.1c10.2-.7 20.7-1.1 31.3-1.1c62.2 0 117.4 12.3 152.5 31.4C369.3 204.9 384 221.7 384 240c0 4-.7 7.9-2.1 11.7c-4.6 13.2-17 25.3-35 35.5c0 0 0 0 0 0c-.1 .1-.3 .1-.4 .2c0 0 0 0 0 0s0 0 0 0c-.3 .2-.6 .3-.9 .5c-35 19.4-90.8 32-153.6 32c-59.6 0-112.9-11.3-148.2-29.1c-1.9-.9-3.7-1.9-5.5-2.9C14.3 274.6 0 258 0 240c0-34.8 53.4-64.5 128-75.4c10.5-1.5 21.4-2.7 32.7-3.5zM416 240c0-21.9-10.6-39.9-24.1-53.4c28.3-4.4 54.2-11.4 76.2-20.5c16.3-6.8 31.5-15.2 43.9-25.5l0 35.4c0 19.3-16.5 37.1-43.8 50.9c-14.6 7.4-32.4 13.7-52.4 18.5c.1-1.8 .2-3.5 .2-5.3zm-32 96c0 18-14.3 34.6-38.4 48c-1.8 1-3.6 1.9-5.5 2.9C304.9 404.7 251.6 416 192 416c-62.8 0-118.6-12.6-153.6-32C14.3 370.6 0 354 0 336l0-35.4c12.5 10.3 27.6 18.7 43.9 25.5C83.4 342.6 135.8 352 192 352s108.6-9.4 148.1-25.9c7.8-3.2 15.3-6.9 22.4-10.9c6.1-3.4 11.8-7.2 17.2-11.2c1.5-1.1 2.9-2.3 4.3-3.4l0 3.4 0 5.7 0 26.3zm32 0l0-32 0-25.9c19-4.2 36.5-9.5 52.1-16c16.3-6.8 31.5-15.2 43.9-25.5l0 35.4c0 10.5-5 21-14.9 30.9c-16.3 16.3-45 29.7-81.3 38.4c.1-1.7 .2-3.5 .2-5.3zM192 448c56.2 0 108.6-9.4 148.1-25.9c16.3-6.8 31.5-15.2 43.9-25.5l0 35.4c0 44.2-86 80-192 80S0 476.2 0 432l0-35.4c12.5 10.3 27.6 18.7 43.9 25.5C83.4 438.6 135.8 448 192 448z"/>
                </svg>
                <a href="#">Find out the course fee</a>
            </div>
            <div class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="30" height="24" fill="white"><!--!Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M184 48l144 0c4.4 0 8 3.6 8 8l0 40L176 96l0-40c0-4.4 3.6-8 8-8zm-56 8l0 40L64 96C28.7 96 0 124.7 0 160l0 96 192 0 128 0 192 0 0-96c0-35.3-28.7-64-64-64l-64 0 0-40c0-30.9-25.1-56-56-56L184 0c-30.9 0-56 25.1-56 56zM512 288l-192 0 0 32c0 17.7-14.3 32-32 32l-64 0c-17.7 0-32-14.3-32-32l0-32L0 288 0 416c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-128z"/>
                </svg>
                <p>Optional placement year</p>
            </div>
            <div class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="30" height="24" fill="white"><!--!Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M482.3 192c34.2 0 93.7 29 93.7 64c0 36-59.5 64-93.7 64l-116.6 0L265.2 495.9c-5.7 10-16.3 16.1-27.8 16.1l-56.2 0c-10.6 0-18.3-10.2-15.4-20.4l49-171.6L112 320 68.8 377.6c-3 4-7.8 6.4-12.8 6.4l-42 0c-7.8 0-14-6.3-14-14c0-1.3 .2-2.6 .5-3.9L32 256 .5 145.9c-.4-1.3-.5-2.6-.5-3.9c0-7.8 6.3-14 14-14l42 0c5 0 9.8 2.4 12.8 6.4L112 192l102.9 0-49-171.6C162.9 10.2 170.6 0 181.2 0l56.2 0c11.5 0 22.1 6.2 27.8 16.1L365.7 192l116.6 0z"/>
                </svg>
                <p>Study abroad</p>
            </div>
        </div>
    </div>
</div>
  
  <div class="dataset-toggle" style="margin-bottom: 2rem;">
    <h1>Subject area tests</h1>
    <p>Choose undergraduate year:</p>
    <button class="dataset-btn active" data-year="2025">2025–26 Courses</button>
    <button class="dataset-btn" data-year="2026">2026–27 Courses</button>
  </div>
  
  <div class="filters">
    <div class="filter-item">
      <div class="search-wrapper">
        <input type="text" id="searchInput" class="search-input" placeholder="Search by title or course…" />
        <button id="clearSearch" class="clear-search" aria-label="Clear search">×</button>
      </div>
          </div>
    <div class="filter-item">
      <div class="select-wrapper">
        <select id="subjectSelect"></select>
        <span class="custom-arrow">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
            <path d="M201.4 374.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 306.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"/>
          </svg>
        </span>
      </div>
    </div>
    <div class="filter-item" style="flex: 0 0 auto;">
      <button id="clearFilters" class="clear-button">Clear filters</button>
    </div>
    
  </div>
  
  

  <div id="courseContainer"></div>
  <div id="paginationControls" style="text-align: center; margin-top: 2rem;"></div>
  <div id="resultsCount" class="results-count"></div>



  <script>
    const CSV_URLS = {
      2025: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTbwCWto19Yyl6peSwvbjGYerbUgeJo2Spkb10B7DbZNHT0K_VU_4e0LNKcHUyu4qp7qnx_bYOVpxJe/pub?gid=1765915941&single=true&output=csv',
      2026: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTbwCWto19Yyl6peSwvbjGYerbUgeJo2Spkb10B7DbZNHT0K_VU_4e0LNKcHUyu4qp7qnx_bYOVpxJe/pub?gid=1229341297&single=true&output=csv',
      PGT: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTbwCWto19Yyl6peSwvbjGYerbUgeJo2Spkb10B7DbZNHT0K_VU_4e0LNKcHUyu4qp7qnx_bYOVpxJe/pub?gid=1313875461&single=true&output=csv'
    };
    
    let currentYear = 2025;
    let allData = [];
    let currentPage = 1;
    const pageSize = 12;
    let activeSubjects = new Set();
    
    async function fetchAndParseCSV(key) {
      const response = await fetch(CSV_URLS[key]);
      const csvText = await response.text();
      return new Promise(resolve => {
        Papa.parse(csvText, {
          header: true,
          skipEmptyLines: true,
          complete: results => resolve(results.data)
        });
      });
    }
    
    function extractSubjects(data) {
      const allSubjects = new Set();
      data.forEach(row => {
        (row['Subject(s)'] || '').split(/[,;]+/).forEach(s => {
          const trimmed = s.trim();
          if (trimmed) allSubjects.add(trimmed);
        });
      });
      return Array.from(allSubjects).sort();
    }
    
    function matchSubjectFilter(row) {
      if (activeSubjects.size === 0) return true;
      const subjects = (row['Subject(s)'] || '').split(/[,;]+/).map(s => s.trim());
      return [...activeSubjects].every(tag => subjects.includes(tag));
    }
    
    function matchSearch(row, query) {
      if (!query) return true;
      const programme = (row.Programme || '').toLowerCase();
      const q = query.toLowerCase();
      return programme.includes(q);
    }
    
    function splitMultiline(value) {
      return (value || '').split(/\r?\n/).map(line => line.trim()).filter(line => line.length);
    }
    
    function highlightMatch(text, query) {
      if (!query) return text;
      const regex = new RegExp(`(${query})`, 'gi');
      return text.replace(regex, '<mark>$1</mark>');
    }
    
    function renderCourseCard(course, query) {
      const wrapper = document.createElement('div');
const levelClass = (course.Level || '').toLowerCase().includes('postgraduate') ? 'pgt' : 'ug';
wrapper.className = `card ${levelClass}`;

      const highlightedTitle = highlightMatch(course.Programme, query);
      const courseNames = splitMultiline(course.Courses);
      const links = splitMultiline(course['Course links']);
    
      wrapper.innerHTML = `
        <div class="level">${course.Level}</div>
        <h2 class="title">${highlightedTitle}</h2>
        <div class="start-date-pill pill-${course.Level.includes('Postgraduate') ? 'PGT' : currentYear}">
  ${course['Start date']}
</div>

        <div class="description">${course.Description}</div>
      `;
    
      const courseList = document.createElement('ul');
      courseList.className = 'course-list';
    
      courseNames.forEach((name, i) => {
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = links[i] || '#';
        a.target = '_blank';
        a.innerHTML = highlightMatch(name, query);
        li.appendChild(a);
        courseList.appendChild(li);
      });
    
      wrapper.appendChild(courseList);
      return wrapper;
    }
    
    function updatePaginationControls(totalPages) {
  const container = document.getElementById('paginationControls');
  container.innerHTML = '';

  const maxVisible = 5; // Max number of numeric buttons (excluding first/last)

  function createButton(page, label = page) {
    const btn = document.createElement('button');
    btn.textContent = label;
    btn.disabled = page === currentPage;
    btn.className = page === currentPage ? 'page-btn current' : 'page-btn';
    btn.addEventListener('click', () => {
      currentPage = page;
      updateFilters();

      const filters = document.querySelector('.filters');
      if (filters) {
        const offset = filters.offsetTop;
        window.scrollTo({ top: offset - 20, behavior: 'smooth' });
      }
    });
    container.appendChild(btn);
  }

  if (totalPages <= maxVisible + 2) {
    // Simple case: show all pages
    for (let i = 1; i <= totalPages; i++) {
      createButton(i);
    }
  } else {
    // Always show first page
    createButton(1);

    if (currentPage > 3) {
      const dots = document.createElement('span');
      dots.textContent = '...';
      container.appendChild(dots);
    }

    const start = Math.max(2, currentPage - 1);
    const end = Math.min(totalPages - 1, currentPage + 1);

    for (let i = start; i <= end; i++) {
      createButton(i);
    }

    if (currentPage < totalPages - 2) {
      const dots = document.createElement('span');
      dots.textContent = '...';
      container.appendChild(dots);
    }

    // Always show last page
    createButton(totalPages);
  }
}

    
    function updateFilters() {
      const query = document.getElementById('searchInput').value.trim().toLowerCase();
      const subjectSelect = document.getElementById('subjectSelect');
      const container = document.getElementById('courseContainer');
      const resultsCount = document.getElementById('resultsCount');
    
      const selected = subjectSelect.value;
      activeSubjects = selected ? new Set([selected]) : new Set();
    
      let filtered = allData.filter(row =>
        matchSubjectFilter(row) && matchSearch(row, query)
      );
    
      const hasSearch = query.length > 0;
      const hasFilter = activeSubjects.size > 0;
    
      container.innerHTML = '';
    
      if (hasSearch || hasFilter) {
  const grouped = {
    Undergraduate: [],
    'Postgraduate Taught': []
  };

  // Group the filtered results by level
  filtered.forEach(course => {
    const level = (course.Level || '').trim();
    if (level === 'Postgraduate Taught') {
      grouped['Postgraduate Taught'].push(course);
    } else {
      grouped['Undergraduate'].push(course);
    }
  });

  // Render grouped course sections
  for (const level of ['Undergraduate', 'Postgraduate Taught']) {
    if (grouped[level].length > 0) {
      // Heading
      const heading = document.createElement('h3');
      heading.className = 'course-group-heading';
      heading.textContent = level;
      container.appendChild(heading);

      // Grid of cards
      const grid = document.createElement('div');
      grid.className = 'course-grid';

      grouped[level].forEach(course => {
        grid.appendChild(renderCourseCard(course, query));
      });

      container.appendChild(grid);
    }
  }

  // Show combined result count
  resultsCount.textContent = `${filtered.length} result${filtered.length === 1 ? '' : 's'}`;

  // Clear pagination controls in filtered view
  document.getElementById('paginationControls').innerHTML = '';
     
      } else {
  // Default flat A–Z view with pagination
  filtered.sort((a, b) => a.Programme.localeCompare(b.Programme));
  container.innerHTML = '';

  const totalPages = Math.ceil(filtered.length / pageSize);
  currentPage = Math.min(currentPage, totalPages || 1);

  const start = (currentPage - 1) * pageSize;
  const paginated = filtered.slice(start, start + pageSize);

  const grid = document.createElement('div');
  grid.className = 'course-grid';

  paginated.forEach(course => {
    grid.appendChild(renderCourseCard(course, query));
  });

  container.appendChild(grid);

  updatePaginationControls(totalPages);

  resultsCount.textContent = filtered.length > 0
    ? `Showing ${start + 1}–${Math.min(start + pageSize, filtered.length)} of ${filtered.length} courses`
    : 'No results found.';
}
    }
    
    async function init(year = 2025, preserve = {}) {
      currentYear = year;
    
      const [ugData, pgtData] = await Promise.all([
        fetchAndParseCSV(year),
        fetchAndParseCSV('PGT')
      ]);
    
      allData = [...ugData, ...pgtData];
    
      const subjectSelect = document.getElementById('subjectSelect');
      const searchInput = document.getElementById('searchInput');
      const clearButton = document.getElementById('clearFilters');
    
      subjectSelect.innerHTML = '';
      const subjects = extractSubjects(allData);
      const defaultOption = document.createElement('option');
      defaultOption.value = '';
      defaultOption.textContent = 'All Subjects';
      subjectSelect.appendChild(defaultOption);
    
      subjects.forEach(subject => {
        const option = document.createElement('option');
        option.value = subject;
        option.textContent = subject;
        subjectSelect.appendChild(option);
      });
    
      subjectSelect.addEventListener('change', () => {
        currentPage = 1;
        updateFilters();
      });
    
      searchInput.addEventListener('input', () => {
        currentPage = 1;
        updateFilters();
      });
    
      clearButton.addEventListener('click', () => {
        searchInput.value = '';
        subjectSelect.value = '';
        currentPage = 1;
        updateFilters();
      });
    
      if (preserve.query !== undefined) searchInput.value = preserve.query;
      if (preserve.subject !== undefined) subjectSelect.value = preserve.subject;
      if (preserve.page !== undefined) currentPage = preserve.page;
      else currentPage = 1;
    
      updateFilters();
    }
    
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.dataset-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const selectedYear = btn.dataset.year;
    
          document.querySelectorAll('.dataset-btn').forEach(b => {
            b.classList.remove('active');
          });
    
          btn.classList.add('active');
    
          const currentSearch = document.getElementById('searchInput')?.value || '';
          const currentSubject = document.getElementById('subjectSelect')?.value || '';
          const currentPg = currentPage;
    
          init(parseInt(selectedYear), {
            query: currentSearch,
            subject: currentSubject,
            page: currentPg
          });
        });
      });
    
      const clearSearch = document.getElementById('clearSearch');
      const searchInput = document.getElementById('searchInput');
    
      searchInput.addEventListener('input', () => {
        currentPage = 1;
        updateFilters();
        clearSearch.style.display = searchInput.value ? 'block' : 'none';
      });
    
      clearSearch.addEventListener('click', () => {
        searchInput.value = '';
        clearSearch.style.display = 'none';
        currentPage = 1;
        updateFilters();
      });
    
      clearSearch.style.display = searchInput.value ? 'block' : 'none';
    
      init();
    });
    </script>
    
</body>
</html>
